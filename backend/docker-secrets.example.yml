# ============================================================
# Docker Compose with Secrets Configuration
# ============================================================
# 
# This file shows how to use Docker secrets for sensitive values.
# Secrets are mounted as files in /run/secrets/ inside containers.
#
# Usage:
#   1. Create secrets files in ./secrets/ directory
#   2. Run: docker compose -f docker-compose.yml -f docker-secrets.yml up
#
# ============================================================

version: '3.8'

secrets:
  secret_key:
    file: ./secrets/secret_key.txt
  database_url:
    file: ./secrets/database_url.txt
  google_client_secret:
    file: ./secrets/google_client_secret.txt
  vapid_private_key:
    file: ./secrets/vapid_private_key.txt
  mail_password:
    file: ./secrets/mail_password.txt
  openai_api_key:
    file: ./secrets/openai_api_key.txt
  aws_secret_access_key:
    file: ./secrets/aws_secret_access_key.txt

services:
  api:
    secrets:
      - secret_key
      - database_url
      - google_client_secret
      - vapid_private_key
      - mail_password
      - openai_api_key
      - aws_secret_access_key
    environment:
      # Non-sensitive config can still use environment variables
      - DEBUG=false
      - ENVIRONMENT=production
      - LOG_FORMAT=json
      # Secrets are read from /run/secrets/ by the application

# ============================================================
# Creating Secrets Files
# ============================================================
#
# mkdir -p secrets
# 
# # Generate a secure secret key
# python -c "import secrets; print(secrets.token_urlsafe(64))" > secrets/secret_key.txt
#
# # Database URL
# echo "postgresql://user:password@db:5432/eli_maor" > secrets/database_url.txt
#
# # Other secrets
# echo "your-google-client-secret" > secrets/google_client_secret.txt
# echo "your-vapid-private-key" > secrets/vapid_private_key.txt
# echo "your-mail-password" > secrets/mail_password.txt
# echo "sk-your-openai-api-key" > secrets/openai_api_key.txt
#
# # Protect secrets files
# chmod 600 secrets/*.txt
#
# ============================================================
